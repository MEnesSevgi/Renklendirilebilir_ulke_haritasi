<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="UTF-8">
    <title>Renklendirilebilir √úlke Haritasƒ±.2</title>
    

  </head>
    
  <body>
  <!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Renklendirilebilir √úlke Haritasƒ±</title>
    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        crossorigin=""
    />
    <style>
        /* CSS kodlarƒ± √∂nceki haliyle aynƒ± */
        html, body {
            margin: 0; padding: 0; height: 100vh; width: 100vw; font-family: Arial, sans-serif;
            display: flex;
            overflow: hidden;
        }
        #map {
            flex-grow: 1;
            height: 100vh;
        }
        /* SAƒû PANEL Gƒ∞ZLEME MANTIƒûI ƒ∞√áƒ∞N EKLENDƒ∞ */
        body.share-view #sidebar {
            display: none;
        }
        body.share-view #map {
            width: 100vw; /* Tam geni≈ülik almasƒ± i√ßin */
        }
        /* HARƒ∞TA BA≈ûLIƒûI ƒ∞√áƒ∞N EKLENDƒ∞ */
        #mapTitle {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000; /* Haritanƒ±n √ºzerinde olmasƒ± i√ßin */
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            font-size: 20px;
            font-weight: bold;
            color: #333;
            max-width: 80%;
            text-align: center;
        }

        #sidebar {
            width: 320px;
            background: #f8f9fa;
            border-left: 1px solid #ccc;
            padding: 10px;
            overflow-y: auto;
            flex-shrink: 0; /* K√º√ß√ºlmesini engelle */
        }
        h2 {
            font-size: 18px;
            margin-top: 0;
        }
        label {
            display: block;
            margin-top: 10px;
            font-weight: bold;
        }
        input[type=color] {
            width: 100%;
            padding: 6px;
            margin-top: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
            font-size: 14px;
            cursor: pointer;
        }
        /* Ba≈ülƒ±k Input Stili */
        #mapTitleInput {
            width: calc(100% - 12px);
            padding: 6px;
            border: 1px solid #ccc;
            border-radius: 4px;
            margin-top: 5px;
            font-size: 14px;
        }
        /* Payla≈ü Butonu Stili */
        #shareButton {
            width: 100%;
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s;
        }
        #shareButton:hover {
            background-color: #0056b3;
        }
        /* ... (Geri kalan CSS aynƒ±) ... */
        #info {
            margin-top: 10px;
            font-size: 14px;
            min-height: 40px;
        }
        .country-label {
            font-weight: 600;
            font-size: 12px;
            color: #222;
            text-align: center;
            white-space: nowrap;
            text-shadow: -1px -1px 0 #fff, 1px -1px 0 #fff, -1px 1px 0 #fff, 1px 1px 0 #fff;
            pointer-events: none;
            user-select: none;
            display: inline-block;
        }
        .leaflet-control-download {
            margin-bottom: 5px;
            padding: 6px 10px;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.4);
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            color: #333;
        }
        .leaflet-control-download:hover {
            background-color: #f4f4f4;
        }
        .leaflet-control-download:disabled {
            background-color: #ddd;
            cursor: not-allowed;
        }
        .legend {
            background: white;
            padding: 6px 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            margin-bottom: 100px;
            max-height: 40vh;
            overflow-y: auto;
        }
        .legend-title {
            font-weight: bold;
            margin-bottom: 5px;
        }
        .layer-control-group {
            margin-top: 15px;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-color {
            width: 18px;
            height: 18px;
            border: 1px solid #777;
            margin-right: 8px;
            flex-shrink: 0;
        }
        .legend-input {
            flex-grow: 1;
            padding: 3px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
        #paintedCountriesList h3 {
            font-size: 16px;
            margin-top: 20px;
            border-top: 1px solid #ccc;
            padding-top: 10px;
        }
        .country-edit-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .country-edit-item input[type=text] {
            flex-grow: 1;
            padding: 3px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
        .country-edit-item label {
             margin-right: 8px;
             font-weight: normal;
             font-size: 12px;
             width: 100px;
             white-space: nowrap;
             overflow: hidden;
             text-overflow: ellipsis;
        }
    </style>
</head>
<body class="map-creator-view">
    <div id="mapTitle" style="display: none;">Harita Ba≈ülƒ±ƒüƒ±</div>

    <div id="map"></div>
    
    <div id="sidebar">
        <label for="mapTitleInput">üó∫Ô∏è Harita Ba≈ülƒ±ƒüƒ±:</label>
        <input type="text" id="mapTitleInput" placeholder="Haritanƒ±za bir ba≈ülƒ±k girin" value="Renklendirilebilir √úlke Haritasƒ±" />
        <p id="infoTitle" style="font-size: 12px; color: #777; margin-top: 5px;">Ba≈ülƒ±k haritada g√∂r√ºnecektir.</p>
        
        <hr style="border: 0; border-top: 1px solid #eee; margin: 15px 0;" />

        <h2>üé® Renklendirme Kontrol√º</h2>
        <label for="colorPicker">Renk Se√ßici:</label>
        <input type="color" id="colorPicker" value="#ff0000" />
        <div id="info">√ñnce renk se√ßin, sonra haritadan √ºlkeye tƒ±klayƒ±n.</div>

        <div class="layer-control-group">
            <label>Harita G√∂r√ºn√ºm√º Se√ßenekleri:</label>
            <div>
                <input type="radio" id="osmBasemap" name="basemap" checked />
                <label for="osmBasemap" style="display: inline; font-weight: normal;">OpenStreetMap Altlƒ±k</label>
            </div>
            <div>
                <input type="radio" id="geojsonOnly" name="basemap" />
                <label for="geojsonOnly" style="display: inline; font-weight: normal;">Sadece Renkli GeoJSON Sƒ±nƒ±rlarƒ± (Altlƒ±ksƒ±z)</label>
            </div>
            <div>
                <input type="radio" id="grayBorders" name="basemap" />
                <label for="grayBorders" style="display: inline; font-weight: normal;">Renkli GeoJSON + Gri Sƒ±nƒ±rlar</label>
            </div>
        </div>
        
        <div id="paintedCountriesList">
              <h3>√úlke ƒ∞simlerini D√ºzenle</h3>
              </div>

        <button id="shareButton">üîó Haritayƒ± Payla≈ü (URL Olu≈ütur)</button>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
    <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6/turf.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <script>
        const map = L.map('map').setView([20, 0], 2);
        
        // Katman Gruplarƒ±
        const labelsGroup = L.layerGroup().addTo(map);
        const polygonsGroup = L.layerGroup().addTo(map);

        // OSM Altlƒ±k Katmanƒ± tanƒ±mƒ±
        const osmTileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        const colorPicker = document.getElementById('colorPicker');
        const info = document.getElementById('info');
        
        const paintedCountriesList = document.getElementById('paintedCountriesList');
        // YENƒ∞ ELEMANLAR
        const mapTitleInput = document.getElementById('mapTitleInput');
        const mapTitleDisplay = document.getElementById('mapTitle');
        const shareButton = document.getElementById('shareButton');

        let countriesGeoJSON = null;
        let grayBordersLayer = null; 
        
        const selectedCountryLayers = {};
        const colorLegends = {}; 
        let currentBasemapSelection = 'osmBasemap';

        // URL Kontrol√º: Payla≈üƒ±m modunda mƒ±yƒ±z?
        const urlParams = new URLSearchParams(window.location.search);
        const isShareView = urlParams.has('config');

        // Payla≈üƒ±m modunda deƒüilsek Harita Ba≈ülƒ±k Alanƒ±nƒ± g√∂ster
        if (!isShareView) {
            mapTitleDisplay.style.display = 'block';
        } else {
            // Payla≈üƒ±m modundaysak saƒü paneli ve diƒüer kontrol butonlarƒ±nƒ± gizle
            document.body.classList.add('share-view');
            // ƒ∞ndirme kontrol√ºn√º gizle (veya kaldƒ±r)
            const downloadControlElement = document.querySelector('.leaflet-control-download');
            if(downloadControlElement) downloadControlElement.parentElement.remove();
        }

        // Lejant Control (Aynƒ± Kaldƒ±)
        const legendControl = L.Control.extend({
            options: { position: 'bottomright' },
            onAdd: function (map) {
                this._div = L.DomUtil.create('div', 'info legend');
                this._div.id = 'legendContainer';
                L.DomEvent.disableClickPropagation(this._div);
                return this._div;
            }
        });
        map.addControl(new legendControl());
        const legendContainer = document.getElementById('legendContainer');

        // ƒ∞ndirme Kontrol√º (Sol Alt) - Payla≈üƒ±m modunda deƒüilsek ekle
        if (!isShareView) {
            const DownloadControl = L.Control.extend({
                options: { position: 'bottomleft' },
                onAdd: function (map) {
                    const button = L.DomUtil.create('button', 'leaflet-control-download');
                    button.id = 'snapshotButton';
                    button.innerHTML = '‚úÇÔ∏è Ekran Alƒ±ntƒ±sƒ± ƒ∞√ßin Tƒ±kla';
                    L.DomEvent.on(button, 'click', showScreenshotInstructions); 
                    L.DomEvent.disableClickPropagation(button);
                    return button;
                }
            });
            map.addControl(new DownloadControl());
            const snapshotButton = document.getElementById('snapshotButton');
        }


        /* --- Ba≈ülƒ±k G√ºncelleme ƒ∞≈ülevi (YENƒ∞) --- */
        mapTitleInput.addEventListener('input', () => {
            const title = mapTitleInput.value.trim() || "Harita Ba≈ülƒ±ƒüƒ±";
            mapTitleDisplay.textContent = title;
        });
        mapTitleInput.dispatchEvent(new Event('input')); // Ba≈ülangƒ±√ß deƒüerini ayarla


        /* --- Payla≈ü ƒ∞≈ülevi (YENƒ∞) --- */

        /**
         * Harita durumunu (Boyanan √úlkeler, Renk A√ßƒ±klamalarƒ±, Ba≈ülƒ±k, G√∂r√ºn√ºm) JSON olarak kaydeder.
         * @returns {string} Base64 kodlanmƒ±≈ü sƒ±kƒ±≈ütƒ±rƒ±lmƒ±≈ü JSON dizesi.
         */
        function saveMapConfig() {
            const config = {
                // Sadece boyanan √ºlkeleri kaydet: { √úlkeID: { color: "#hex", name: "Etiket Adƒ±" } }
                countries: Object.keys(selectedCountryLayers).reduce((acc, id) => {
                    const country = selectedCountryLayers[id];
                    // name, orijinal isimden farklƒ±ysa kaydet. (Daha kƒ±sa URL i√ßin)
                    const name = country.name !== country.originalName ? country.name : undefined;
                    acc[id] = { color: country.color, name };
                    return acc;
                }, {}),
                // Lejant a√ßƒ±klamalarƒ±nƒ± kaydet: { "#hex": "A√ßƒ±klama" }
                legends: Object.keys(colorLegends).reduce((acc, color) => {
                    if (colorLegends[color].label) acc[color] = colorLegends[color].label;
                    return acc;
                }, {}),
                title: mapTitleInput.value.trim() || undefined,
                view: currentBasemapSelection,
                center: map.getCenter().lat.toFixed(4) + ',' + map.getCenter().lng.toFixed(4),
                zoom: map.getZoom()
            };
            
            const jsonString = JSON.stringify(config);
            // URL'yi kƒ±sa tutmak i√ßin Base64 kodlama kullanƒ±lƒ±r
            return btoa(jsonString); 
        }

        /**
         * Base64 kodlanmƒ±≈ü konfig√ºrasyonu √ß√∂zerek haritayƒ± y√ºkler. (Y√ºkleme i≈ülevi i√ßine entegre edilecek)
         * @param {string} encodedConfig - Base64 kodlanmƒ±≈ü konfig√ºrasyon dizesi.
         */
        function loadMapConfig(encodedConfig) {
            try {
                const jsonString = atob(encodedConfig);
                const config = JSON.parse(jsonString);
                
                // Ba≈ülƒ±k
                if (config.title) {
                    mapTitleDisplay.textContent = config.title;
                    mapTitleDisplay.style.display = 'block';
                } else {
                    mapTitleDisplay.style.display = 'none';
                }

                // G√∂r√ºn√ºm
                if (config.view) {
                    // updateMapLayers √ßaƒürƒ±lƒ±rken √ºlkelerin boyanmasƒ± i√ßin countriesGeoJSON'un y√ºklenmesi beklenmeli.
                    currentBasemapSelection = config.view;
                    const radio = document.getElementById(config.view);
                    if (radio) radio.checked = true;
                }

                // Harita Merkezi ve Zoom
                if (config.center && config.zoom) {
                    const [lat, lng] = config.center.split(',');
                    map.setView([parseFloat(lat), parseFloat(lng)], parseInt(config.zoom));
                }

                // Lejant A√ßƒ±klamalarƒ±
                if (config.legends) {
                    for (const color in config.legends) {
                        colorLegends[color] = { label: config.legends[color], countries: [] };
                    }
                }
                
                // √úlkeleri Boya (GeoJSON y√ºklendikten sonra yapƒ±lacak)
                return config.countries || {};

            } catch (error) {
                console.error("Harita konfig√ºrasyonu y√ºklenemedi:", error);
                return {};
            }
        }


        // Payla≈ü butonuna tƒ±klandƒ±ƒüƒ±nda
        if (!isShareView) {
            shareButton.addEventListener('click', () => {
                const encodedConfig = saveMapConfig();
                const shareURL = window.location.origin + window.location.pathname + '?config=' + encodedConfig;

                navigator.clipboard.writeText(shareURL).then(() => {
                    alert('Payla≈üƒ±m baƒülantƒ±sƒ± panoya kopyalandƒ±:\n' + shareURL);
                }).catch(err => {
                    console.error('Baƒülantƒ± kopyalanamadƒ±:', err);
                    alert('Baƒülantƒ± olu≈üturuldu (Panoya kopyalanamadƒ±, elle kopyalayƒ±n):\n' + shareURL);
                });
            });
        }


        /* --- Harita Y√ºkleme (G√ºncellendi) --- */

        // ... (Diƒüer yardƒ±mcƒ± fonksiyonlar aynƒ± kaldƒ±) ...
        function getCountryName(feature) {
             return feature.properties.ADMIN || feature.properties.NAME || feature.properties.name || "Bilinmeyen";
        }
        function getCountryId(feature) {
             const id = feature.properties.ADMIN || feature.properties.NAME;
             return id ? id.trim() : getCountryName(feature).trim();
        }
        function getLargestPolygonCentroid(feature) {
             const geom = feature.geometry;
             if (geom.type === "MultiPolygon") {
                 let maxArea = 0;
                 let largestPolygon = null;
                 geom.coordinates.forEach(polygonCoords => {
                     const poly = turf.polygon(polygonCoords);
                     const area = turf.area(poly);
                     if (area > maxArea) {
                         maxArea = area;
                         largestPolygon = poly;
                     }
                 });
                 if (largestPolygon) {
                     return turf.centroid(largestPolygon).geometry.coordinates;
                 }
             } else if (geom.type === "Polygon") {
                 return turf.centroid(feature).geometry.coordinates;
             }
             return turf.centroid(feature).geometry.coordinates;
        }


        function updateCountryEditList() {
             // ... (Aynƒ± kaldƒ±) ...
             paintedCountriesList.innerHTML = '<h3>√úlke ƒ∞simlerini D√ºzenle</h3>';
             
             for (const countryId in selectedCountryLayers) {
                 const country = selectedCountryLayers[countryId];
                 
                 const itemDiv = document.createElement('div');
                 itemDiv.className = 'country-edit-item';
                 
                 const label = document.createElement('label');
                 label.textContent = country.originalName || country.name; 
                 label.title = country.originalName || country.name; 
                 
                 const input = document.createElement('input');
                 input.type = 'text';
                 input.value = country.name; 
                 input.placeholder = country.originalName;
                 input.setAttribute('data-country-id', countryId);

                 input.addEventListener('input', (e) => {
                     const newName = e.target.value.trim() || country.originalName;
                     
                     selectedCountryLayers[countryId].name = newName;
                     
                     const marker = selectedCountryLayers[countryId].label;
                     if (marker) {
                          const newIcon = L.divIcon({
                              className: 'country-label',
                              html: newName,
                              iconSize: [100, 20],
                              iconAnchor: [50, 10]
                          });
                          marker.setIcon(newIcon);
                     }
                     
                     info.textContent = `${country.originalName} i√ßin etiket "${newName}" olarak g√ºncellendi.`;
                 });

                 itemDiv.appendChild(label);
                 itemDiv.appendChild(input);
                 paintedCountriesList.appendChild(itemDiv);
             }

             if (Object.keys(selectedCountryLayers).length === 0) {
                  const p = document.createElement('p');
                  p.style.fontSize = '12px';
                  p.style.color = '#777';
                  p.textContent = 'Hen√ºz boyanan √ºlke yok.';
                  paintedCountriesList.appendChild(p);
             }
        }

        function updateLegend() {
            // ... (Aynƒ± kaldƒ±) ...
             legendContainer.innerHTML = '<div class="legend-title">Boyanan Renkler ve A√ßƒ±klamalar</div>';

             const uniqueColors = {};
             for (const id in selectedCountryLayers) {
                 const color = selectedCountryLayers[id].color;
                 if (!uniqueColors[color]) {
                     const existingLabel = colorLegends[color] ? colorLegends[color].label : '';
                     uniqueColors[color] = existingLabel;
                 }
             }
             
             for (const color in uniqueColors) {
                 let existingLabel = uniqueColors[color];
                 const itemDiv = document.createElement('div');
                 itemDiv.className = 'legend-item';

                 const colorBox = document.createElement('div');
                 colorBox.className = 'legend-color';
                 colorBox.style.backgroundColor = color;
                 
                 const input = document.createElement('input');
                 input.type = 'text';
                 input.className = 'legend-input';
                 input.placeholder = `A√ßƒ±klama giriniz (√∂rn: ${color})`;
                 input.value = existingLabel;

                 input.addEventListener('input', (e) => {
                     if (!colorLegends[color]) { colorLegends[color] = { label: '', countries: [] }; }
                     colorLegends[color].label = e.target.value;
                 });
                 
                 if (!colorLegends[color]) {
                     colorLegends[color] = { label: existingLabel, countries: [] };
                 }

                 itemDiv.appendChild(colorBox);
                 itemDiv.appendChild(input);
                 legendContainer.appendChild(itemDiv);
             }
        }
        
        function addOrUpdateSelectedCountry(feature, fillColor, displayName) { // fillColor ve displayName parametreleri eklendi
            const countryId = getCountryId(feature); 
            const originalName = getCountryName(feature); 
            const color = fillColor || colorPicker.value;
            
            // Eƒüer displayName verilmediyse, mevcut d√ºzenlenmi≈ü adƒ± kullan veya orijinal adƒ±
            const currentDisplayName = displayName || (selectedCountryLayers[countryId] ? selectedCountryLayers[countryId].name : originalName);

            if (selectedCountryLayers[countryId]) {
                polygonsGroup.removeLayer(selectedCountryLayers[countryId].polygon);
                labelsGroup.removeLayer(selectedCountryLayers[countryId].label);
            }

            const polygon = L.geoJSON(feature, {
                style: {
                    fillColor: color,
                    color: 'white', 
                    weight: 1,
                    opacity: 1,
                    fillOpacity: 0.7,
                    dashArray: ''
                }
            }).addTo(polygonsGroup);

            const centroidCoords = getLargestPolygonCentroid(feature);
            const latlng = [centroidCoords[1], centroidCoords[0]];

            const label = L.marker(latlng, {
                icon: L.divIcon({
                    className: 'country-label',
                    html: currentDisplayName, // Mevcut adƒ± kullan
                    iconSize: [100, 20],
                    iconAnchor: [50, 10]
                }),
                interactive: false
            }).addTo(labelsGroup);

            selectedCountryLayers[countryId] = { 
                polygon, 
                label, 
                color: color, 
                name: currentDisplayName, 
                originalName: originalName 
            };
            
            updateLegend();
            if (!isShareView) updateCountryEditList(); // Payla≈üƒ±m modunda listeyi g√ºncelleme
            
            if (!isShareView) info.textContent = `${originalName} se√ßildi ve renklendirildi. Toplam ${Object.keys(selectedCountryLayers).length} farklƒ± √ºlke boyandƒ±.`;
        }


        function updateMapLayers(selection) {
             currentBasemapSelection = selection;
             
             if (selection === 'osmBasemap') {
                 if (!map.hasLayer(osmTileLayer)) map.addLayer(osmTileLayer);
                 document.getElementById('map').style.backgroundColor = ''; 
                 if (!isShareView) snapshotButton.innerHTML = 'üñºÔ∏è Haritayƒ± ƒ∞ndir (PNG)';
             } else {
                 if (map.hasLayer(osmTileLayer)) map.removeLayer(osmTileLayer);
                 document.getElementById('map').style.backgroundColor = '#A2C5E8'; 
                 if (!isShareView) snapshotButton.innerHTML = '‚úÇÔ∏è Ekran Alƒ±ntƒ±sƒ± ƒ∞√ßin Tƒ±kla';
             }

             if (selection === 'grayBorders') {
                 if (countriesGeoJSON && !grayBordersLayer) {
                     grayBordersLayer = L.geoJSON(countriesGeoJSON, {
                         style: {
                             fillColor: '#F5F5F5', color: '#B0B0B0', weight: 0.5, opacity: 1, fillOpacity: 1, 
                         },
                         onEachFeature: (feature, layer) => { layer.options.interactive = false; layer.off('click'); }
                     }).addTo(map);
                     polygonsGroup.bringToFront(); 
                 }
                 if (grayBordersLayer && !map.hasLayer(grayBordersLayer)) { map.addLayer(grayBordersLayer); }
                 labelsGroup.addTo(map);
             } else {
                 if (grayBordersLayer && map.hasLayer(grayBordersLayer)) { map.removeLayer(grayBordersLayer); }
                 labelsGroup.addTo(map);
             }
        }
        
        // Sadece ana g√∂r√ºn√ºmde harita se√ßim radyo butonlarƒ±nƒ± dinle
        if (!isShareView) {
            document.querySelectorAll('input[name="basemap"]').forEach(radio => {
                radio.addEventListener('change', (e) => {
                    updateMapLayers(e.target.id);
                });
            });
        }

        function showScreenshotInstructions() {
             alert(
                 "Harita g√∂r√ºnt√ºs√ºn√º almak i√ßin l√ºtfen tarayƒ±cƒ±nƒ±zƒ±n veya i≈ületim sisteminizin ekran alƒ±ntƒ±sƒ± (screenshot) aracƒ±nƒ± kullanƒ±n.\n\n" +
                 "Kƒ±sayollar:\n" +
                 "Windows: Shift + Windows Tu≈üu + S\n" +
                 "macOS: Shift + Command (‚åò) + 4\n\n" +
                 "Bu y√∂ntem, haritadaki etiket kayma sorununu √ß√∂zmenize yardƒ±mcƒ± olacaktƒ±r."
             );
        };


        // GeoJSON y√ºkleme ve harita ba≈ülatma
        fetch('https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson')
            .then(res => res.json())
            .then(data => {
                countriesGeoJSON = data;
                
                let countriesToPaint = {};
                if (isShareView) {
                    const encodedConfig = urlParams.get('config');
                    if (encodedConfig) {
                        countriesToPaint = loadMapConfig(encodedConfig);
                    }
                }

                if (Object.keys(countriesToPaint).length > 0) {
                    // Payla≈üƒ±m modunda, kayƒ±tlƒ± konfig√ºrasyondan √ºlkeleri boya
                    countriesGeoJSON.features.forEach(feature => {
                        const countryId = getCountryId(feature);
                        const config = countriesToPaint[countryId];
                        if (config) {
                            // name varsa onu kullan, yoksa orijinalini kullanacak (addOrUpdateSelectedCountry i√ßinde)
                            addOrUpdateSelectedCountry(feature, config.color, config.name); 
                        }
                    });
                    updateMapLayers(currentBasemapSelection); // config'den gelen view'i uygula

                } else {
                    // Normal modda
                    if (!isShareView) info.textContent = "Renk se√ßin ve haritadan √ºlkeye tƒ±klayƒ±n.";
                    updateMapLayers(currentBasemapSelection); 
                }

            })
            .catch(err => {
                console.error("GeoJSON y√ºklenirken hata:", err);
                if (!isShareView) info.textContent = "Harita y√ºklenemedi.";
            });
        
        /* --- Tƒ±klama Olayƒ± (Sadece normal modda aktif) --- */
        if (!isShareView) {
            map.on('click', e => {
                if (!countriesGeoJSON) return;

                const selectedColor = colorPicker.value;
                if (!selectedColor) {
                    info.textContent = "L√ºtfen √∂nce bir renk se√ßin.";
                    return;
                }

                let foundFeature = null;

                for (const feature of countriesGeoJSON.features) {
                    if (feature.geometry && turf.booleanPointInPolygon(turf.point([e.latlng.lng, e.latlng.lat]), feature)) {
                        foundFeature = feature;
                        break;
                    }
                }

                if (!foundFeature) {
                    info.textContent = "Hi√ßbir √ºlke se√ßilmedi.";
                    return;
                }

                const countryId = getCountryId(foundFeature);
                
                if (!countryId || countryId === "Bilinmeyen") {
                     info.textContent = `${getCountryName(foundFeature)} i√ßin ge√ßerli bir kimlik bulunamadƒ±. Boyanamaz.`;
                     return;
                }
                
                // Normal renklendirme (renk se√ßiciden gelen renkle)
                addOrUpdateSelectedCountry(foundFeature, selectedColor);
            });
        }
        
        if (!isShareView) {
            updateLegend();
            updateCountryEditList();
        }
    </script>
</body>
</html>
    
  </body>
  
</html>
